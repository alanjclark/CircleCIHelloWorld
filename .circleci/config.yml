version: 2.1

orbs:
  macos: circleci/macos@2.4.1


jobs:
  build:
    macos:
      xcode: "15.2.0"
    resource_class: macos.m1.medium.gen1
    steps:
      - macos/enable-vnc
      - macos/install-rosetta
      - run:
          name: Create keychain
          command: security create-keychain -p "" circleci.keychain
      - run:
          name: Save password in keychain
          command: security add-generic-password -a myaccount -w letmein -s circleci.keychain
      - run:
          security find-generic-password -a myaccount -s circleci.keychain
      # - gcp-cli/install
      # - run:
          # name: install gcp gcp-cli
          # command: |
          #   (New-Object Net.WebClient).DownloadFile("https://dl.google.com/dl/cloudsdk/channels/rapid/GoogleCloudSDKInstaller.exe", "$env:Temp\GoogleCloudSDKInstaller.exe")
          #   & $env:Temp\GoogleCloudSDKInstaller.exe
          # shell: powershell.exe

      - run:
          name: Check Ruby version
          command: which -a ruby && ruby --version

workflows:
  macos:
    jobs:
      - build:
          pre-steps:
            - run: rbenv global 3.2.2