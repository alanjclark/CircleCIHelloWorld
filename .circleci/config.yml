version: 2.1

orbs:
  windows: circleci/windows@5.0.0


jobs:
  build:
    executor: 
      name: windows/server-2019
    steps:
      - run:
          name: set env var
          command: |
            New-Item -Path "C:\Temp" -Name "Temp" -ItemType "directory"
            New-Item -Path . -Name "job1-1.txt" -ItemType "file"
            New-Item -Path . -Name "job1-2.txt" -ItemType "file"
            New-Item -Path . -Name "job2.txt" -ItemType "file"
            New-Item -Path . -Name "job3.txt" -ItemType "file"
            New-Item -Path . -Name "job4.txt" -ItemType "file"
            $Env:PATH -split ";" | Out-String | Set-Content -Path C:\Temp\job1-1.txt
            $Env:PATH += ";C:\Program Files\LLVM\bin"
            $Env:PATH -split ";" | Out-String | Set-Content -Path C:\Temp\job1-2.txt

      - run:
          name: recall env var
          command: |
            $Env:PATH -split ";" | Out-String | Set-Content -Path C:\Temp\job2.txt

      - run:
          name: set env var again
          command: |
            $Env:PATH += ";C:\Program Files\LLVM\bin"
            Import-Module $env:ChocolateyInstall\helpers\chocolateyProfile.psm1
            refreshenv
            $Env:PATH split ";" | Out-String | Set-Content -Path C:\Temp\job3.txt

      - run:
          name: recall env var
          command: |
            $Env:PATH -split ";" | Out-String | Set-Content -Path C:\Temp\job4.txt

      - store_artifacts:
          path: C:\Temp

workflows:
  check-this-out:
    jobs:
      - build